
{% extends "base.html" %} {% block extra_css %} 
<script src="https://cdn.tailwindcss.com"></script>
<link rel="stylesheet" href="https://unpkg.com/@sjmc11/tourguidejs/dist/css/tour.min.css">

{% endblock %} {% block content%}


{% if logged_in %}

<main class="bg-zinc-800">
  <div class="mx-20">
      <section class="w-full my-8">
          <h2 class="mb-8 text-3xl">あなたにおすすめの漫画</h2>
          
          <div data-tg-order='1' data-tg-tour='あなたのアンケートをもとにマッチングされた漫画です。' class="swiper mySwiper">
              <div class="swiper-wrapper">
                {% if data != [] %}
                  {% for title, url in data %}
                  {% if url != "no" %}
                  <div class="swiper-slide bg-center bg-cover">
                      <a href="/{{ title }}/detail" >
                          <img class="block w-full h-full" src="{{ url }}" alt="">
                      </a>
                  </div>
                  {% else %}
                  <div class="swiper-slide">
                    <a href="/{{ title }}/detail">
                        <img class="image-placeholder" src="https://illustrain.com/img/work/2016/illustrain08-book02.png" alt="">
                    </a>
                  </div>             
                  {% endif %}
                  {% endfor %}
                  {% endif %}
      
                  {% if favolite_book !=[] %}
                  {% for url in favolite_book %}
                  <div class="swiper-slide">
                    <img class="image-placeholder" src="{{ url }}" alt="">
                  </div>
                  
                  
                  {% endfor %}
                  {% endif %}
                  
              </div>
              <div class="swiper-button-prev"></div>
              <div class="swiper-button-next"></div>
          </div>
        </section>


    

    <section class="my-20" id="user">
        <h2 class="text-3xl">あなたの属性に近いユーザー</h2>
        <ul data-tg-order='2' data-tg-tour='あなたのアンケートの回答と似ているユーザーです。' class="flex flex-wrap list-none">
          {% if user_query != None %}
          {% for id in user_query %}
          {% if user_doc_ref.document(id).get().to_dict()["username"] != username %}
          <li class="w-2/12 text-center box-border m-2">

            <img src="https://kotonohaworks.com/free-icons/wp-content/uploads/kkrn_icon_user_1.png">
            <div>
              <a href="/{{id}}/userpage" class="text-white hover:text-blue-500">{{user_doc_ref.document(id).get().to_dict()["username"]}}</a>


          </div>    
          </li>
      
        {% endif %}
          {% endfor %}
          {% endif %}
        
      </ul>
    </section>

    <section class="my-20" id="reviewer">
        <h2 class="text-3xl" >フォローしたユーザー</h2>
        <ul class="flex flex-wrap list-none">
          
          {% for follow in follow_data %}
          <li class="w-2/12 text-center box-border m-2">
          <img src="https://kotonohaworks.com/free-icons/wp-content/uploads/kkrn_icon_user_1.png">
          <div>
            <a href="/{{follow[1]}}/userpage" class="hover:text-blue-500">{{follow[0]}}</a>
            
          </div>    
        </li>
          {% endfor %}
   
      </ul>
    </section>
{% endif %}
<!--検索いらないのでコメントアウト
    <section class="w-full my-8">
      <h2 class="mb-8 text-3xl">漫画検索</h2>
      <div class="">
        <form action="/home" method="post" class="flex m-5">
          <input type="text" name="search_query" placeholder="漫画検索" class="relative m-0 -mr-0.5 block min-w-0 w-10/100 rounded-l border border-solid border-neutral-300 bg-transparent bg-clip-padding px-3 py-[0.25rem] text-base font-normal leading-[1.6] text-neutral-700 outline-none transition duration-200 ease-in-out focus:z-[3] focus:border-primary focus:text-neutral-700 focus:shadow-[inset_0_0_0_1px_rgb(59,113,202)] focus:outline-none dark:border-neutral-600 dark:text-neutral-200 dark:placeholder:text-neutral-200 dark:focus:border-primary">
          <button type="submit" class="relative z-[2] flex items-center rounded-r bg-blue-500 hover:bg-blue-600 px-6 py-2.5 text-xs font-medium uppercase leading-tight text-white shadow-md transition duration-150 ease-in-out hover:bg-primary-700 hover:shadow-lg focus:bg-primary-700 focus:shadow-lg focus:outline-none focus:ring-0 active:bg-primary-800 active:shadow-lg">検索</button>
        </form>
      </div>
      {% if results %}
      <h2>検索結果</h2>
        <ul>
          {% for result in results %}
            <li><a href="/{{ result.title }}/detail">{{ result.title }}</a></li>
          {% endfor %}
        </ul>
      {% endif %}
    </section>
-->
    <section class="w-full my-8">
      <h2 class="mb-8 text-3xl">レビュー数の多い漫画</h2>
      
      <div class="swiper mySwiper">
          <div class="swiper-wrapper">


              {% if all_review_book !=[] %}
              {% for title,url in all_review_book %}
              <div class="swiper-slide">
                <a href="/{{ title }}/detail" >
                  <img class="block w-full h-full hover:scale-105" src="{{ url }}" alt="">
              </a>
              </div>
              
              
              {% endfor %}
              {% endif %}
          </div>
          <div class="swiper-button-prev"></div>
          <div class="swiper-button-next"></div>
      </div>
    </section>

    <section class="w-full my-8">
      <h2 class="mb-8 text-3xl">レビュー数の多い（一週間以内）漫画</h2>
      
      <div class="swiper mySwiper">
          <div class="swiper-wrapper">


              {% if week_review_book !=[] %}
              {% for title,url in week_review_book %}
              <div class="swiper-slide">
                <a href="/{{ title }}/detail" >
                  <img class="block w-full h-full" src="{{ url }}" alt="">
                </a>
              </div>
              
              
              {% endfor %}
              {% endif %}
          </div>
          <div class="swiper-button-prev"></div>
          <div class="swiper-button-next"></div>
      </div>
    </section>


    <section class="w-full my-8">
      <h2 class="mb-8 text-3xl">ブックマーク数が多い漫画</h2>
      
      <div class="swiper mySwiper">
          <div class="swiper-wrapper">


              {% if bookmark_book !=[] %}
              {% for title,url in bookmark_book %}
              <div class="swiper-slide">
                <a href="/{{ title }}/detail" >
                  <img class="block w-full h-full" src="{{ url }}" alt="">
                </a>
              </div>
              
              
              {% endfor %}
              {% endif %}
          </div>
          <div class="swiper-button-prev"></div>
          <div class="swiper-button-next"></div>
      </div>
    </section>


    <section class="w-full my-8">
      <h2 class="mb-8 text-3xl">高評価の漫画</h2>
      
      <div class="swiper mySwiper">
          <div class="swiper-wrapper">


              {% if high_evaluate_book !=[] %}
              {% for title,url in high_evaluate_book %}
              <div class="swiper-slide">
                <a href="/{{ title }}/detail" >
                  <img class="block w-full h-full" src="{{ url }}" alt="">
                </a>
              </div>
              
              
              {% endfor %}
              {% endif %}
          </div>
          <div class="swiper-button-prev"></div>
          <div class="swiper-button-next"></div>
      </div>
    </section>

    <section class="my-20" id="user">
      <h2 class="text-3xl">レビュー投稿数が多いユーザー</h2>
      <ul class="flex flex-wrap list-none">
        {% if all_review_users != None %}
        {% for id in all_review_users %}
        {% if user_doc_ref.document(id).get().to_dict()["username"] != username %}
        <li class="w-2/12 text-center box-border m-2">

          <img class='hover:scale-105' src="https://kotonohaworks.com/free-icons/wp-content/uploads/kkrn_icon_user_1.png">
          <div>
            <a href="/{{id}}/userpage" class="text-white hover:text-blue-500">{{user_doc_ref.document(id).get().to_dict()["username"]}}</a>


        </div>    
        </li>
    
      {% endif %}
        {% endfor %}
        {% endif %}
      
    </ul>
  </section>

  <section class="my-20" id="user">
    <h2 class="text-3xl">レビュー投稿数が多い(直近一週間)ユーザー</h2>
    <ul class="flex flex-wrap list-none">
      {% if oneweek_review_users != None %}
      {% for id in oneweek_review_users %}
      {% if user_doc_ref.document(id).get().to_dict()["username"] != username %}
      <li class="w-2/12 text-center box-border m-2">

        <img src="https://kotonohaworks.com/free-icons/wp-content/uploads/kkrn_icon_user_1.png">
        <div>
          <a href="/{{id}}/userpage" class="text-white hover:text-blue-500">{{user_doc_ref.document(id).get().to_dict()["username"]}}</a>


      </div>    
      </li>
  
    {% endif %}
      {% endfor %}
      {% endif %}
    
  </ul>
</section>

<section class="my-20" id="user">
  <h2 class="text-3xl">フォロワーが多いユーザー</h2>
  <ul class="flex flex-wrap list-none">
    {% if most_follow_user != None %}
    {% for id in most_follow_user %}
    {% if user_doc_ref.document(id).get().to_dict()["username"] != username %}
    <li class="w-2/12 text-center box-border m-2">

      <img src="https://kotonohaworks.com/free-icons/wp-content/uploads/kkrn_icon_user_1.png">
      <div>
        <a href="/{{id}}/userpage" class="text-white hover:text-blue-500">{{user_doc_ref.document(id).get().to_dict()["username"]}}</a>


    </div>    
    </li>

  {% endif %}
    {% endfor %}
    {% endif %}
  
</ul>
</section>
<section id="timeline">
  <h2 class="text-3xl">タイムライン</h2>
  <ul id="review-list" class="mx-auto w-4/5 flex flex-wrap flex-row">
    {% for review in review_doc_ref.stream() %}
    <div class="w-full flex items-start my-3 p-4 bg-zinc-700">
      <div style="width: 120px;">
        <a href="/{{ review.to_dict()["mangaTitle"] }}/detail">
          <img src="{{ comics_doc_ref.document(review.to_dict()['mangaTitle']).get().to_dict()['image'] }}" class="h-auto w-full object-contain transition duration-500 rounded-lg" alt="Comic Image">
        </a>
      </div>
      <div class="ml-4 flex-1">
        <a href="/review_detail?review_id={{ review.id }}" class="block">
          <p class="mb-1 break-all text-2xl font-bold">{{review.to_dict()["mangaTitle"]}}</p>
          <div class="flex items-center">
            <img src="https://kotonohaworks.com/free-icons/wp-content/uploads/kkrn_icon_user_1.png" alt="" class="h-auto max-h-8">
            <p class="ml-2 break-all">{{user_doc_ref.document(review.to_dict()["user_id"]).get().to_dict()["username"]}}</p>
          </div>
          <p class="mt-1 text-xl">
            {% for _ in range(review.get("evaluation")) %}
              <span class="text-yellow-400">★</span>
            {% endfor %}
          </p>
          <p class="my-1 break-all">{{review.to_dict()["contents"]}}</p>
        </a>
      </div>
    </div>
    {% endfor %}
  </ul>
</section>
</main>
    <script src="https://cdn.jsdelivr.net/npm/swiper@9/swiper-bundle.min.js"></script>
    <script src="../static/javascript/home.js"></script>
    <script src="https://unpkg.com/@sjmc11/tourguidejs/dist/tour.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
{% endblock %}

